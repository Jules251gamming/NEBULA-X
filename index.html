// L'AUDIT RÉEL AVEC FILE D'ATTENTE (PROTÉGÉ)
(function(){
    const _0x1a2b=['\x68\x74\x74\x70\x73\x3A\x2F\x2F\x6E\x65\x62\x75\x6C\x61\x2D\x78\x2D\x38\x72\x67\x61\x2E\x6F\x6E\x72\x65\x6E\x64\x65\x72\x2E\x63\x6F\x6D\x2F\x61\x70\x69\x2F\x64\x69\x61\x67\x6E\x6F\x73\x74\x69\x63'];
    
    window['runRealAudit'] = async function() {
        const t = document['getElementById']('target')['value'];
        const o = document['getElementById']('terminal-output');
        const b = document['getElementById']('btn-test');
        if(!t) return alert("Cible requise.");

        b['disabled'] = !0;
        o['innerHTML'] = "";

        // --- SYSTÈME DE FILE D'ATTENTE ALÉATOIRE ---
        const queuePos = Math.floor(Math.random() * 45) + 1; // Position entre 1 et 45
        const waitTime = Math.floor(Math.random() * (20000 - 1000 + 1)) + 1000; // Entre 1 et 20 sec
        
        const queueDiv = document.createElement('div');
        queueDiv.className = "text-yellow-500 font-bold animate-pulse";
        queueDiv.innerHTML = `> [QUEUE] Charge serveur élevée. Vous êtes n°${queuePos} dans la file d'attente...`;
        o.appendChild(queueDiv);

        // Simulation de l'attente
        await new Promise(x => setTimeout(x, waitTime));

        const connectDiv = document.createElement('div');
        connectDiv.className = "text-cyan-400 font-bold";
        connectDiv.innerHTML = `> [SUCCESS] Accès accordé. Connexion au Master Node...`;
        o.appendChild(connectDiv);
        // ------------------------------------------

        try {
            const r = await fetch(_0x1a2b[0], {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON['stringify']({target: t})
            });
            const d = await r['json']();

            if(d['success']){
                const logs = [
                    `[AUTH] Responsabilité validée par l'utilisateur.`,
                    `[RESOLVE] IP Réelle : ${d['ip']}`,
                    `[NET] Latence : ${d['latency']}`,
                    `[HTTP] Status : ${d['status']} (Live)`,
                    `<span class="text-yellow-500 font-bold">[!] PORT_SCAN : BLOQUÉ (Version .EXE requise)</span>`,
                    `<span class="text-red-500 font-bold">[!] FLOOD_L7 : BLOQUÉ (Accès Premium uniquement)</span>`,
                    `[SUCCESS] Audit 75% terminé.`
                ];

                for(const s of logs){
                    await new Promise(x => setTimeout(x, 600));
                    const e = document['createElement']('div');
                    e['className'] = "text-green-400 pl-2 border-l border-white/10";
                    e['innerHTML'] = `<span class="opacity-30">#</span> ${s}`;
                    o['appendChild'](e);
                    o['scrollTop'] = o['scrollHeight'];
                }
            } else { throw new Error(); }
        } catch(e) {
            const f = document['createElement']('div');
            f['className'] = "text-red-500 font-bold";
            f['innerText'] = "> [CRITICAL_ERR] NODE_TIMEOUT : Serveur saturé ou cible protégée.";
            o['appendChild'](f);
        } finally {
            b['disabled'] = !1;
        }
    }
})();
